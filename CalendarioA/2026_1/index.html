
<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calendario AcadÃ©mico Areandina 2026_01</title>
<style>
  :root {
    --bg: #fff7fb;
    --panel: #ffffff;
    --ink: #1f2937;
    --muted: #6b7280;
    --line: #f1d7e6;
    --shadow: 0 10px 30px rgba(31,41,55,.08);
    --pink2: #ffd6e8;
    --blue2: #e8f1ff;
    --icon: #6b7280;
    --head: #ffe4f2;
  }
  * { box-sizing: border-box; }
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans";
    color: var(--ink);
    /* Fondo externo (coloca fondo.png junto al HTML) */
    background-image: url('fondo.png');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
  }
  .wrap { max-width: 1220px; margin: 0 auto; padding: 18px; }
  .titleRow { display:flex; align-items:center; gap:10px; }
  .mascot { width:30px;height:30px;border-radius:12px;background:linear-gradient(135deg,var(--pink2),var(--blue2));box-shadow:var(--shadow);display:flex;align-items:center;justify-content:center; }
  h1 { font-size: 18px; margin:0; }
  .sub { font-size: 13px; color: var(--muted); margin-top: 6px; max-width: 980px; }

  .legendTable {
    width: 100%;
    border: 1px solid var(--line);
    border-radius: 14px;
    overflow: hidden;
    background: rgba(255,255,255,.85);
    box-shadow: var(--shadow);
    margin: 14px 0;
  }
  .legendHead {
    background: var(--head);
    padding: 10px 12px;
    font-weight: 800;
    color: var(--ink);
    border-bottom: 1px solid var(--line);
  }
  .legendGrid { display:grid; grid-template-columns: repeat(7, 1fr); }
  .legendCell {
    padding: 10px 10px;
    border-right: 1px solid var(--line);
    display:flex; gap:8px; align-items:center; justify-content:center;
    text-align:center; font-size: 12px; min-width:0;
  }
  .legendCell:nth-child(7n) { border-right:none; }
  .swatch { width: 10px; height: 10px; border-radius: 999px; }
  .icon { width: 14px; height: 14px; display:inline-block; }
  svg { width:14px; height:14px; fill:none; stroke: var(--icon); stroke-width:2; stroke-linecap:round; stroke-linejoin:round; }

  .controls { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin: 10px 0 14px; }
  .pill { background:var(--panel); border:1px solid var(--line); border-radius:14px; box-shadow:var(--shadow); padding:8px 10px; display:flex; gap:8px; align-items:center; }
  select { border:none; outline:none; background:transparent; font-size:13px; color:var(--ink); }

  .cal { background:var(--panel); border:1px solid var(--line); border-radius:18px; box-shadow:var(--shadow); overflow:hidden; }
  .calHead {
    display:grid;
    grid-template-columns: 42px repeat(7, 1fr); /* SEM + 7 days */
    background: var(--head);
    border-bottom:1px solid var(--line);
  }
  .calHead div { padding: 10px 8px; text-align:center; font-weight:900; font-size:12px; color: #334155; }
  .calHead .semHead { font-weight:1000; }

  .grid {
    display:grid;
    grid-template-columns: 42px repeat(7, 1fr);
    grid-auto-rows: 110px;
  }
  .semCell {
    border-right: 1px solid var(--line);
    border-bottom: 1px solid var(--line);
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding-top: 10px;
    font-weight: 1000;
    color: #334155;
    font-size: 12px;
    background: #f9a8d4;
  }
  .cell {
    padding: 8px;
    border-right: 1px solid var(--line);
    border-bottom: 1px solid var(--line);
    display:flex;
    flex-direction:column;
    gap:6px;
    min-width:0;
  }
  .cell:nth-child(8n) { border-right:none; } /* last col in 8-col grid */
  .holidayCell { background: rgba(100,116,139,.06); }

  .dateRow { display:flex; justify-content:space-between; align-items:center; font-weight:900; font-size:12px; }
  .dateNum { display:inline-flex; gap:6px; align-items:center; cursor:pointer; padding: 2px 6px; border-radius: 10px; }
  .dateNum:hover { background: rgba(255,107,176,.10); }
  .muted { color: var(--muted); font-weight:800; font-size:11px; }

  .chips { display:flex; flex-direction:column; gap:6px; overflow:auto; padding-right:2px; }
  .chip {
    border-radius: 12px;
    padding: 6px 8px;
    font-size: 11px;
    display:flex;
    gap:6px;
    align-items:center;
    background: rgba(255,255,255,.92);
    border:1px solid rgba(241,215,230,.95);
    cursor:pointer;
    user-select:none;
    min-width:0;
    width: max-content;
    max-width: 100%;
  }
  .chip:hover { outline:2px solid rgba(255,107,176,.18); }
  .chip.iconOnly { padding: 6px 6px; width: 28px; justify-content:center; }
  .label { overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

  .notes { --c: #16a34a; }
  .eval  { --c: #e11d48; }
  .eje   { --c: #ea580c; }
  .cohort{ --c: #7c3aed; }
  .doc   { --c: #0f766e; }
  .hol   { --c: #64748b; }
  .period{ --c: #2563eb; }
  .chip { border-left: 4px solid var(--c, #94a3b8); }

  .overlay { position:fixed; inset:0; background: rgba(31,41,55,.25); display:none; align-items:center; justify-content:center; padding:18px; }
  .overlay.show { display:flex; }
  .modal { width:min(580px,100%); background:var(--panel); border:1px solid var(--line); border-radius:18px; box-shadow:var(--shadow); padding:14px; }
  .modalTop { display:flex; justify-content:space-between; gap:10px; align-items:flex-start; }
  .modal h2 { font-size:14px; margin:0; }
  .meta { font-size:12px; color:var(--muted); margin-top:4px; }
  .desc { font-size:13px; margin-top:10px; line-height:1.35; white-space:pre-line; }
  .btn { border:1px solid var(--line); background: rgba(255,255,255,.9); border-radius:12px; padding:6px 10px; cursor:pointer; font-weight:800; }

  .backdrop{
    min-height: 100vh;
    background:
      radial-gradient(1100px 520px at 10% -10%, rgba(255,214,232,.80) 0%, transparent 55%),
      radial-gradient(900px 520px at 100% 0%, rgba(232,241,255,.75) 0%, transparent 55%),
      rgba(255,247,251,.75);
    backdrop-filter: blur(2px);
  }

  .drops{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top: 12px;
  }
  details.drop{
    background: var(--panel);
    border: 1px solid var(--line);
    border-radius: 14px;
    box-shadow: var(--shadow);
    overflow: hidden;
    min-width: min(520px, 100%);
    flex: 1 1 520px;
  }
  details.drop summary{
    list-style: none;
    cursor: pointer;
    padding: 10px 12px;
    font-weight: 900;
    font-size: 13px;
    display:flex;
    align-items:center;
    justify-content: space-between;
    gap:10px;
    user-select:none;
  }
  details.drop summary::-webkit-details-marker{ display:none; }
  .caret{
    width: 0; height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 8px solid #334155;
    opacity: .85;
    transform: rotate(0deg);
    transition: transform .18s ease;
    flex: 0 0 auto;
  }
  details.drop[open] .caret{ transform: rotate(180deg); }
  .dropBody{
    padding: 10px 12px 12px;
    border-top: 1px solid var(--line);
    font-size: 12.5px;
    color: #334155;
    line-height: 1.35;
    white-space: pre-line;
  }

  .todayHeart{
    position:absolute;
    left:50%;
    top:56%;
    transform: translate(-50%, -50%);
    font-size: 26px;
    line-height: 1;
    pointer-events:none;
    filter: drop-shadow(0 6px 14px rgba(225,29,72,.18));
  }
  .cell{ position: relative; }
</style>
</head>
<body>
<div class="backdrop">
<div class="wrap">
  <div class="titleRow">
    <div class="mascot" aria-hidden="true">ðŸŽ€</div>
    <h1>Calendario AcadÃ©mico Areandina 2026_01</h1>
  </div>
  <div class="sub">Fechas principales.</div>

  <div class="drops">
    <details class="drop" >
      <summary>
        <span>Periodo presencial: 02-feb-2026 â†’ 30-may-2026</span>
        <span class="caret" aria-hidden="true"></span>
      </summary>
      <div class="dropBody">Presencial
â€¢ Inicio: 02-feb-2026
â€¢ Fin: 30-may-2026
Cortes (fechas)
â€¢ Corte 1: EvaluaciÃ³n 09â€“14 mar | Notas 16â€“21 mar
â€¢ Corte 2: EvaluaciÃ³n 20â€“25 abr | Notas 27-abrâ€“02-may
â€¢ Final: EvaluaciÃ³n 25â€“30 may | Notas 01â€“05 jun
EvaluaciÃ³n docente
â€¢ 30-mar â†’ 16-may</div>
    </details>

    <details class="drop">
      <summary>
        <span>Periodo virtual: Cohortes 1â€“3</span>
        <span class="caret" aria-hidden="true"></span>
      </summary>
      <div class="dropBody">Virtual (por cohorte)
â€¢ Cohorte 1 (1A): 02-feb-2026 â†’ 12-abr-2026
â€¢ Cohorte 2: 06-abr-2026 â†’ 07-jun-2026
â€¢ Cohorte 3 (1B): 27-abr-2026 â†’ 28-jun-2026</div>
    </details>
  </div>

  <div class="legendTable">
    <div class="legendHead">NotaciÃ³n</div>
    <div class="legendGrid" id="legendGrid"></div>
  </div>

  <div class="controls">
    <div class="pill">
      <span style="font-size:12px;color:var(--muted);font-weight:900;">Mes</span>
      <select id="monthSel"></select>
    </div>
    <div class="pill">
      <span style="font-size:12px;color:var(--muted);font-weight:900;">Filtro</span>
      <select id="filterSel">
        <option value="all">Todo</option>
        <option value="notes">Notas</option>
        <option value="eval">EvaluaciÃ³n</option>
        <option value="eje">Tarea eje</option>
        <option value="cohort">Cohorte</option>
        <option value="doc">Eval. docente</option>
        <option value="hol">Festivos</option>
        <option value="period">Periodo presencial</option>
      </select>
    </div>
    <div class="pill" id="todayPill" title="Fecha actual">
      <span style="font-size:12px;color:var(--muted);font-weight:900;">Hoy</span>
      <span id="todayText" style="font-size:13px;font-weight:900;"></span>
    </div>

  </div>

  <div class="cal">
    <div class="calHead">
      <div class="semHead">SEM</div>
      <div>Dom</div><div>Lun</div><div>Mar</div><div>MiÃ©</div><div>Jue</div><div>Vie</div><div>SÃ¡b</div>
    </div>
    <div id="grid" class="grid"></div>
  </div>
</div>

<div id="overlay" class="overlay" role="dialog" aria-modal="true">
  <div class="modal">
    <div class="modalTop">
      <div>
        <h2 id="mTitle"></h2>
        <div class="meta" id="mMeta"></div>
      </div>
      <button class="btn" id="closeBtn">Cerrar</button>
    </div>
    <div class="desc" id="mDesc"></div>
  </div>
</div>

<script>
const PERIOD_START = new Date("2026-01-26T00:00:00");
const PERIOD_END   = new Date("2026-06-16T00:00:00");
const EVENTS = [{"date": "2026-02-02", "kind": "period", "title": "Inicio periodo presencial", "detail": "Inicio del periodo acadÃ©mico presencial: 2026-02-02 (fin: 2026-05-30).", "priority": 2, "iconOnly": true}, {"date": "2026-05-30", "kind": "period", "title": "Fin periodo presencial", "detail": "Fin del periodo acadÃ©mico presencial: 2026-05-30 (inicio: 2026-02-02).", "priority": 2, "iconOnly": true}, {"date": "2026-03-09", "kind": "eval", "title": "Inicio evaluaciÃ³n 1er corte", "detail": "evaluaciÃ³n 1er corte: 2026-03-09 â†’ 2026-03-14.", "priority": 2, "iconOnly": true}, {"date": "2026-03-14", "kind": "eval", "title": "Fin evaluaciÃ³n 1er corte", "detail": "evaluaciÃ³n 1er corte: 2026-03-09 â†’ 2026-03-14.", "priority": 3, "iconOnly": true}, {"date": "2026-03-16", "kind": "notes", "title": "Inicio notas 1er corte", "detail": "notas 1er corte: 2026-03-16 â†’ 2026-03-21.", "priority": 1, "iconOnly": true}, {"date": "2026-03-21", "kind": "notes", "title": "Fin notas 1er corte", "detail": "notas 1er corte: 2026-03-16 â†’ 2026-03-21.", "priority": 2, "iconOnly": true}, {"date": "2026-04-20", "kind": "eval", "title": "Inicio evaluaciÃ³n 2do corte", "detail": "evaluaciÃ³n 2do corte: 2026-04-20 â†’ 2026-04-25.", "priority": 2, "iconOnly": true}, {"date": "2026-04-25", "kind": "eval", "title": "Fin evaluaciÃ³n 2do corte", "detail": "evaluaciÃ³n 2do corte: 2026-04-20 â†’ 2026-04-25.", "priority": 3, "iconOnly": true}, {"date": "2026-04-27", "kind": "notes", "title": "Inicio notas 2do corte", "detail": "notas 2do corte: 2026-04-27 â†’ 2026-05-02.", "priority": 1, "iconOnly": true}, {"date": "2026-05-02", "kind": "notes", "title": "Fin notas 2do corte", "detail": "notas 2do corte: 2026-04-27 â†’ 2026-05-02.", "priority": 2, "iconOnly": true}, {"date": "2026-05-25", "kind": "eval", "title": "Inicio evaluaciÃ³n final", "detail": "evaluaciÃ³n final: 2026-05-25 â†’ 2026-05-30.", "priority": 2, "iconOnly": true}, {"date": "2026-05-30", "kind": "eval", "title": "Fin evaluaciÃ³n final", "detail": "evaluaciÃ³n final: 2026-05-25 â†’ 2026-05-30.", "priority": 3, "iconOnly": true}, {"date": "2026-06-01", "kind": "notes", "title": "Inicio notas final", "detail": "notas final: 2026-06-01 â†’ 2026-06-05.", "priority": 1, "iconOnly": true}, {"date": "2026-06-05", "kind": "notes", "title": "Fin notas final", "detail": "notas final: 2026-06-01 â†’ 2026-06-05.", "priority": 2, "iconOnly": true}, {"date": "2026-03-30", "kind": "doc", "title": "Inicio evaluaciÃ³n docente", "detail": "EvaluaciÃ³n docente: 2026-03-30 â†’ 2026-05-16.", "priority": 3, "iconOnly": true}, {"date": "2026-05-16", "kind": "doc_end_text", "title": "Fin evaluaciÃ³n docente", "detail": "EvaluaciÃ³n docente: 2026-03-30 â†’ 2026-05-16.", "priority": 3, "iconOnly": false}, {"date": "2026-02-02", "kind": "cohort", "title": "Inicio Cohorte 1 (1A)", "detail": "Cohorte 1 (1A): 2026-02-02 â†’ 2026-04-12.", "priority": 3, "iconOnly": true}, {"date": "2026-04-12", "kind": "cohort", "title": "Fin Cohorte 1 (1A)", "detail": "Cohorte 1 (1A): 2026-02-02 â†’ 2026-04-12.", "priority": 3, "iconOnly": true}, {"date": "2026-04-06", "kind": "cohort", "title": "Inicio Cohorte 2", "detail": "Cohorte 2: 2026-04-06 â†’ 2026-06-07.", "priority": 3, "iconOnly": true}, {"date": "2026-06-07", "kind": "cohort", "title": "Fin Cohorte 2", "detail": "Cohorte 2: 2026-04-06 â†’ 2026-06-07.", "priority": 3, "iconOnly": true}, {"date": "2026-04-27", "kind": "cohort", "title": "Inicio Cohorte 3 (1B)", "detail": "Cohorte 3 (1B): 2026-04-27 â†’ 2026-06-28.", "priority": 3, "iconOnly": true}, {"date": "2026-06-28", "kind": "cohort", "title": "Fin Cohorte 3 (1B)", "detail": "Cohorte 3 (1B): 2026-04-27 â†’ 2026-06-28.", "priority": 3, "iconOnly": true}, {"date": "2026-02-02", "kind": "eje", "title": "Tarea eje 1 Â· Cohorte 1 (1A)", "detail": "Tarea eje 1 (Cohorte 1 (1A)). Fecha: 2026-02-02 (lunes).", "priority": 3, "iconOnly": true}, {"date": "2026-02-16", "kind": "eje", "title": "Tarea eje 2 Â· Cohorte 1 (1A)", "detail": "Tarea eje 2 (Cohorte 1 (1A)). Fecha: 2026-02-16 (lunes).", "priority": 3, "iconOnly": true}, {"date": "2026-03-02", "kind": "eje", "title": "Tarea eje 3 Â· Cohorte 1 (1A)", "detail": "Tarea eje 3 (Cohorte 1 (1A)). Fecha: 2026-03-02 (lunes).", "priority": 3, "iconOnly": true}, {"date": "2026-03-16", "kind": "eje", "title": "Tarea eje 4 Â· Cohorte 1 (1A)", "detail": "Tarea eje 4 (Cohorte 1 (1A)). Fecha: 2026-03-16 (lunes).", "priority": 3, "iconOnly": true}, {"date": "2026-03-16", "kind": "notes", "title": "Entrega de notas (Eje 4) Â· Cohorte 1 (1A)", "detail": "Entrega de notas asociadas a la semana de Tarea eje 4. Plazo: 2026-03-16 â†’ 2026-03-18 (hasta miÃ©rcoles).", "priority": 1, "iconOnly": true}, {"date": "2026-03-18", "kind": "notes", "title": "Cierre notas (Eje 4) Â· Cohorte 1 (1A)", "detail": "Ãšltimo dÃ­a (miÃ©rcoles) para entregar notas de la semana de Tarea eje 4 (Cohorte 1 (1A)).", "priority": 2, "iconOnly": true}, {"date": "2026-04-06", "kind": "eje", "title": "Tarea eje 1 Â· Cohorte 2", "detail": "Tarea eje 1 (Cohorte 2). Fecha: 2026-04-06 (lunes).", "priority": 3, "iconOnly": true}, {"date": "2026-04-20", "kind": "eje", "title": "Tarea eje 2 Â· Cohorte 2", "detail": "Tarea eje 2 (Cohorte 2). Fecha: 2026-04-20 (lunes).", "priority": 3, "iconOnly": true}, {"date": "2026-05-04", "kind": "eje", "title": "Tarea eje 3 Â· Cohorte 2", "detail": "Tarea eje 3 (Cohorte 2). Fecha: 2026-05-04 (lunes).", "priority": 3, "iconOnly": true}, {"date": "2026-05-18", "kind": "eje", "title": "Tarea eje 4 Â· Cohorte 2", "detail": "Tarea eje 4 (Cohorte 2). Fecha: 2026-05-18 (lunes).", "priority": 3, "iconOnly": true}, {"date": "2026-05-18", "kind": "notes", "title": "Entrega de notas (Eje 4) Â· Cohorte 2", "detail": "Entrega de notas asociadas a la semana de Tarea eje 4. Plazo: 2026-05-18 â†’ 2026-05-20 (hasta miÃ©rcoles).", "priority": 1, "iconOnly": true}, {"date": "2026-05-20", "kind": "notes", "title": "Cierre notas (Eje 4) Â· Cohorte 2", "detail": "Ãšltimo dÃ­a (miÃ©rcoles) para entregar notas de la semana de Tarea eje 4 (Cohorte 2).", "priority": 2, "iconOnly": true}, {"date": "2026-04-27", "kind": "eje", "title": "Tarea eje 1 Â· Cohorte 3 (1B)", "detail": "Tarea eje 1 (Cohorte 3 (1B)). Fecha: 2026-04-27 (lunes).", "priority": 3, "iconOnly": true}, {"date": "2026-05-11", "kind": "eje", "title": "Tarea eje 2 Â· Cohorte 3 (1B)", "detail": "Tarea eje 2 (Cohorte 3 (1B)). Fecha: 2026-05-11 (lunes).", "priority": 3, "iconOnly": true}, {"date": "2026-05-25", "kind": "eje", "title": "Tarea eje 3 Â· Cohorte 3 (1B)", "detail": "Tarea eje 3 (Cohorte 3 (1B)). Fecha: 2026-05-25 (lunes).", "priority": 3, "iconOnly": true}, {"date": "2026-06-08", "kind": "eje", "title": "Tarea eje 4 Â· Cohorte 3 (1B)", "detail": "Tarea eje 4 (Cohorte 3 (1B)). Fecha: 2026-06-08 (lunes).", "priority": 3, "iconOnly": true}, {"date": "2026-06-08", "kind": "notes", "title": "Entrega de notas (Eje 4) Â· Cohorte 3 (1B)", "detail": "Entrega de notas asociadas a la semana de Tarea eje 4. Plazo: 2026-06-08 â†’ 2026-06-10 (hasta miÃ©rcoles).", "priority": 1, "iconOnly": true}, {"date": "2026-06-10", "kind": "notes", "title": "Cierre notas (Eje 4) Â· Cohorte 3 (1B)", "detail": "Ãšltimo dÃ­a (miÃ©rcoles) para entregar notas de la semana de Tarea eje 4 (Cohorte 3 (1B)).", "priority": 2, "iconOnly": true}];
const HOLIDAYS = [{"date": "2026-01-01", "name": "AÃ±o Nuevo"}, {"date": "2026-01-12", "name": "Reyes Magos"}, {"date": "2026-03-23", "name": "San JosÃ©"}, {"date": "2026-03-31", "name": "Semana Santa (receso)"}, {"date": "2026-04-02", "name": "Jueves Santo"}, {"date": "2026-04-03", "name": "Viernes Santo"}, {"date": "2026-05-01", "name": "DÃ­a del Trabajo"}, {"date": "2026-05-18", "name": "AscensiÃ³n"}, {"date": "2026-06-08", "name": "Corpus Christi"}, {"date": "2026-06-15", "name": "Sagrado CorazÃ³n"}];
const LEGEND = [{"key": "notes", "label": "Notas", "color": "#16a34a", "icon": "bell"}, {"key": "eval", "label": "EvaluaciÃ³n", "color": "#e11d48", "icon": "check"}, {"key": "eje", "label": "Tarea eje", "color": "#ea580c", "icon": "flag"}, {"key": "cohort", "label": "Cohorte", "color": "#7c3aed", "icon": "book"}, {"key": "doc", "label": "Eval. docente", "color": "#0f766e", "icon": "book"}, {"key": "hol", "label": "Festivo", "color": "#64748b", "icon": "flag"}, {"key": "period", "label": "Periodo presencial", "color": "#2563eb", "icon": "flag"}];
const SEM_MAP = {"2026-02-02": 1, "2026-02-09": 2, "2026-02-16": 3, "2026-02-23": 4, "2026-03-02": 5, "2026-03-09": 6, "2026-03-16": 7, "2026-03-23": 8, "2026-04-06": 9, "2026-04-13": 10, "2026-04-20": 11, "2026-04-27": 12, "2026-05-04": 13, "2026-05-11": 14, "2026-05-18": 15, "2026-05-25": 16};

const cortes = {"corte1_eval": ["2026-03-09", "2026-03-14"], "corte1_notas": ["2026-03-16", "2026-03-21"], "corte2_eval": ["2026-04-20", "2026-04-25"], "corte2_notas": ["2026-04-27", "2026-05-02"], "corte3_eval": ["2026-05-25", "2026-05-30"], "corte3_notas": ["2026-06-01", "2026-06-05"]};

const COHORTS = [{"name": "Cohorte 1 (1A)", "start": "2026-02-02", "end": "2026-04-12"}, {"name": "Cohorte 2", "start": "2026-04-06", "end": "2026-06-07"}, {"name": "Cohorte 3 (1B)", "start": "2026-04-27", "end": "2026-06-28"}];
const ACADEMIC = {"start": "2026-02-02", "end": "2026-05-30", "skip_start": "2026-03-30", "skip_end": "2026-04-05"};

const holidayMap = new Map(HOLIDAYS.map(h => [h.date, h.name]));
const monthsEs = ["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];
const pad2 = n => String(n).padStart(2,'0');

function dateKey(d) { return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`; }
function parseISO(s) { return new Date(s+"T00:00:00"); }
function inISO(d, s, e) {
  const x = new Date(d.getFullYear(), d.getMonth(), d.getDate());
  const a = parseISO(s), b = parseISO(e);
  return x >= a && x <= b;
}
function dayInRange(d) {
  const x = new Date(d.getFullYear(), d.getMonth(), d.getDate());
  return x >= PERIOD_START && x <= PERIOD_END;
}
function monthStart(d) { return new Date(d.getFullYear(), d.getMonth(), 1); }
function monthEnd(d) { return new Date(d.getFullYear(), d.getMonth()+1, 0); }

function corteFor(d) {
  if (inISO(d, cortes.corte1_eval[0], cortes.corte1_eval[1]) || inISO(d, cortes.corte1_notas[0], cortes.corte1_notas[1]) || d < parseISO(cortes.corte2_eval[0])) return "Corte 1";
  if (inISO(d, cortes.corte2_eval[0], cortes.corte2_eval[1]) || inISO(d, cortes.corte2_notas[0], cortes.corte2_notas[1]) || d < parseISO(cortes.corte3_eval[0])) return "Corte 2";
  return "Corte 3";
}
function cohortsFor(d) {
  const out = [];
  for (const c of COHORTS) if (inISO(d, c.start, c.end)) out.push(c.name);
  return out;
}

function mondayOfRowStart(sunday) {
  const m = new Date(sunday);
  m.setDate(sunday.getDate() + 1); // Monday in that displayed week
  return m;
}

function semForRow(sunday) {
  const mon = mondayOfRowStart(sunday);
  const monKey = dateKey(mon);
  return SEM_MAP[monKey] || ""; // blank if outside/skip
}

function svgIcon(name) {
  if (name === "bell") return `<span class="icon" aria-hidden="true">
    <svg viewBox="0 0 24 24"><path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"></path><path d="M13.73 21a2 2 0 01-3.46 0"></path></svg>
  </span>`;
  if (name === "flag") return `<span class="icon" aria-hidden="true">
    <svg viewBox="0 0 24 24"><path d="M4 22V2"></path><path d="M4 4h12l-1 5 1 5H4"></path></svg>
  </span>`;
  if (name === "check") return `<span class="icon" aria-hidden="true">
    <svg viewBox="0 0 24 24"><path d="M20 6L9 17l-5-5"></path></svg>
  </span>`;
  if (name === "book") return `<span class="icon" aria-hidden="true">
    <svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"></path></svg>
  </span>`;
  return svgIcon("flag");
}
function kindToClassAndIcon(kind) {
  if (kind === "notes") return {cls:"notes", icon:"bell"};
  if (kind === "eval") return {cls:"eval", icon:"check"};
  if (kind === "eje") return {cls:"eje", icon:"flag"};
  if (kind === "cohort") return {cls:"cohort", icon:"book"};
  if (kind === "doc" || kind === "doc_end_text") return {cls:"doc", icon:"book"};
  if (kind === "period") return {cls:"period", icon:"flag"};
  return {cls:"", icon:"flag"};
}

function openModal(title, dateISO, detail) {
  const dt = new Date(dateISO+"T00:00:00");
  document.getElementById("mTitle").textContent = title;
  document.getElementById("mMeta").textContent = dt.toLocaleDateString("es-CO", {weekday:"long", year:"numeric", month:"short", day:"numeric"});
  document.getElementById("mDesc").textContent = detail || "";
  document.getElementById("overlay").classList.add("show");
}
function closeModal() { document.getElementById("overlay").classList.remove("show"); }
document.getElementById("closeBtn").addEventListener("click", closeModal);
document.getElementById("overlay").addEventListener("click", (e)=>{ if (e.target.id==="overlay") closeModal(); });

function buildLegend() {
  const grid = document.getElementById("legendGrid");
  grid.innerHTML = "";
  for (const it of LEGEND) {
    const c = document.createElement("div");
    c.className = "legendCell";
    c.innerHTML = `<span class="swatch" style="background:${it.color}"></span>${svgIcon(it.icon)}<span style="font-weight:900;color:#334155;white-space:nowrap;">${it.label}</span>`;
    grid.appendChild(c);
  }
}

function buildMonthOptions() {
  const sel = document.getElementById("monthSel");
  sel.innerHTML = "";
  let cur = new Date(PERIOD_START.getFullYear(), PERIOD_START.getMonth(), 1);
  const end = new Date(PERIOD_END.getFullYear(), PERIOD_END.getMonth(), 1);
  while (cur <= end) {
    const opt = document.createElement("option");
    opt.value = `${cur.getFullYear()}-${pad2(cur.getMonth()+1)}`;
    opt.textContent = `${monthsEs[cur.getMonth()]} ${cur.getFullYear()}`;
    sel.appendChild(opt);
    cur = new Date(cur.getFullYear(), cur.getMonth()+1, 1);
  }
  // Mes por defecto: mes actual si cae dentro del periodo visible, si no, el inicio del periodo
  const now = new Date();
  const nowFirst = new Date(now.getFullYear(), now.getMonth(), 1);
  const visFirst = new Date(PERIOD_START.getFullYear(), PERIOD_START.getMonth(), 1);
  const visLast  = new Date(PERIOD_END.getFullYear(), PERIOD_END.getMonth(), 1);
  const within = nowFirst >= visFirst && nowFirst <= visLast;
  const base = within ? now : PERIOD_START;
  sel.value = `${base.getFullYear()}-${pad2(base.getMonth()+1)}`;
}

function render() {
  const filter = document.getElementById("filterSel").value;
  const monthSel = document.getElementById("monthSel").value;
  const [y,m] = monthSel.split("-").map(Number);
  const focus = new Date(y, m-1, 1);

  const ms = monthStart(focus);
  const me = monthEnd(focus);

  const start = new Date(ms);
  start.setDate(ms.getDate() - ms.getDay()); // sunday
  const end = new Date(me);
  end.setDate(me.getDate() + (6 - me.getDay()));

  const byDate = new Map();
  for (const ev of EVENTS) {
    if (!byDate.has(ev.date)) byDate.set(ev.date, []);
    byDate.get(ev.date).push(ev);
  }
  for (const [k,v] of byDate.entries()) v.sort((a,b)=>(a.priority??3)-(b.priority??3));

  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  for (let weekStart = new Date(start); weekStart <= end; weekStart.setDate(weekStart.getDate()+7)) {
    // SEM column
    const sem = semForRow(weekStart);
    const semCell = document.createElement("div");
    semCell.className = "semCell";
    semCell.textContent = sem;
    grid.appendChild(semCell);

    // 7 day cells
    for (let i=0;i<7;i++) {
      const d = new Date(weekStart);
      d.setDate(weekStart.getDate()+i);
      const cell = document.createElement("div");
      cell.className = "cell";
      const dk = dateKey(d);
      const inMonth = d.getMonth() === focus.getMonth();
      
      // CorazÃ³n para "hoy" (si el mes mostrado incluye hoy)
      const _now = new Date();
      const _todayKey = dateKey(_now);
      if (dk === _todayKey){
        const heart = document.createElement("div");
        heart.className = "todayHeart";
        heart.textContent = "â¤ï¸";
        cell.appendChild(heart);
      }
if (holidayMap.has(dk) && dayInRange(d)) cell.classList.add("holidayCell");

      const head = document.createElement("div");
      head.className = "dateRow";

      const num = document.createElement("div");
      num.className = "dateNum";
      num.innerHTML = `<span>${d.getDate()}</span><span class="muted">${inMonth ? "" : monthsEs[d.getMonth()].slice(0,3)}</span>`;
      num.addEventListener("click", () => {
        const corte = corteFor(d);
        const cs = cohortsFor(d);
        const hol = (holidayMap.has(dk) && dayInRange(d)) ? holidayMap.get(dk) : "";
        let detail = `Proceso: ${corte}.`;
        detail += `\nCohorte(s): ${cs.length ? cs.join(", ") : "ninguna"}.`;
        if (hol) detail += `\nFestivo/Receso: ${hol}.`;
        // SEM value (if any) for this date's week
        const ws = new Date(d); ws.setDate(d.getDate()-d.getDay()); // sunday
        const semv = semForRow(ws);
        if (semv) detail += `\nSemana (SEM): ${semv}.`;
        openModal("Estado del dÃ­a", dk, detail);
      });

      head.appendChild(num);
      cell.appendChild(head);

      const chips = document.createElement("div");
      chips.className = "chips";

      if (holidayMap.has(dk) && dayInRange(d) && (filter === "all" || filter === "hol")) {
        const ch = document.createElement("div");
        ch.className = "chip hol iconOnly";
        ch.innerHTML = svgIcon("flag");
        ch.title = "Festivo";
        ch.addEventListener("click", () => openModal("Festivo", dk, holidayMap.get(dk)));
        chips.appendChild(ch);
      }

      const todays = byDate.get(dk) || [];
      for (const ev of todays) {
        const map = kindToClassAndIcon(ev.kind);
        if (filter !== "all" && map.cls !== filter) continue;
        const iconOnly = ev.iconOnly === true;
        const ch = document.createElement("div");
        ch.className = `chip ${map.cls} ${iconOnly ? "iconOnly" : ""}`;
        if (iconOnly) {
          ch.innerHTML = svgIcon(map.icon);
          ch.title = ev.title;
        } else {
          ch.innerHTML = svgIcon(map.icon) + `<span class="label">${ev.title}</span>`;
        }
        ch.addEventListener("click", () => openModal(ev.title, dk, ev.detail));
        chips.appendChild(ch);
      }

      cell.appendChild(chips);
      grid.appendChild(cell);
    }
  }
}

buildLegend();
buildMonthOptions();

// Fecha actual en cabecera (siempre visible) + semana (SEM) si aplica
(function setToday(){
  const el = document.getElementById("todayText");
  if (!el) return;
  const now = new Date();

  const opts = { weekday:"long", year:"numeric", month:"long", day:"numeric" };
  let s = now.toLocaleDateString("es-CO", opts);
  s = s.charAt(0).toUpperCase() + s.slice(1);

  // Semana (SEM) si estamos en periodo acadÃ©mico presencial (segÃºn SEM_MAP)
  function pad2(n){ return String(n).padStart(2,'0'); }
  function dateKey(d){ return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`; }
  function semForDate(d){
    // domingo de la semana visual
    const sunday = new Date(d);
    sunday.setDate(d.getDate() - d.getDay());
    // lunes de esa fila
    const monday = new Date(sunday);
    monday.setDate(sunday.getDate() + 1);
    const mk = dateKey(monday);
    return (typeof SEM_MAP !== "undefined" && SEM_MAP[mk]) ? SEM_MAP[mk] : "";
  }
  const sem = semForDate(now);
  el.textContent = sem ? `Semana ${sem} Â· ${s}` : s;
})();
render();
document.getElementById("monthSel").addEventListener("change", render);
document.getElementById("filterSel").addEventListener("change", render);
</script>
</div>
</body>
</html>
