<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pilares del Pensamiento computacional</title>
<style>
  :root{
    --ok:#22c55e; --warn:#facc15; --err:#ef4444;
    --bg:#070b16; --glass:rgba(15,27,60,.45); --line:#2a3c74;
  }
  body{margin:0;font-family:Poppins,Arial,sans-serif;color:#eaf2ff;background:var(--bg)}
  #starfield{position:fixed;inset:0;z-index:-1}
  h1{color:#4ade80;padding:16px;margin:0;text-align:center}
  .sub{color:#a9b9e6;padding:0 16px 16px;text-align:center}
  .biobot{
    margin:16px;padding:14px;border-radius:14px;
    background:rgba(14,26,62,.7);border:1px solid var(--line);
    box-shadow:0 0 14px rgba(74,222,128,.35);
  }
  .biobot h2{margin:0 0 6px;text-shadow:0 0 6px #4ade80}
  .tray{display:flex;flex-wrap:wrap;gap:10px;padding:12px;justify-content:center}
  .chip{
    user-select:none;cursor:grab;border-radius:12px;padding:10px 12px;
    font-size:.95rem;background:rgba(20,32,70,.6);border:1px solid #2c3f79;
    box-shadow:0 4px 12px rgba(0,0,0,.4)
  }
  .chip:active{cursor:grabbing;transform:scale(.97)}
  .zones{display:grid;gap:14px;padding:12px}
  @media(min-width:860px){.zones{grid-template-columns:1fr 1fr 1fr}}
  .zone{
    min-height:140px;border:1.5px dashed #2e3f76;border-radius:14px;padding:10px;
    background:rgba(15,27,60,.4);transition:.2s
  }
  .zone.active{border-color:#4ade80;box-shadow:0 0 8px #4ade80}
  .zone h3{margin:0 0 6px;text-align:center}
  .bucket{min-height:60px;display:flex;flex-wrap:wrap;gap:8px;justify-content:center}
  .console{border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:10px;
    background:var(--glass);box-shadow:0 8px 24px rgba(0,0,0,.4)}
  .state{margin-top:6px;font-weight:bold;text-align:center}
  .ok{color:var(--ok)}.warn{color:var(--warn)}.err{color:var(--err)}
  button{margin:12px;padding:10px 14px;background:#238636;color:#fff;border:none;border-radius:10px;cursor:pointer}
  button:hover{background:#2ea043}
  #resultado{margin:16px;padding:14px;border-radius:12px;background:var(--glass)}
</style>
</head>
<body>
<canvas id="starfield"></canvas>

<h1>Pilar 1: Descomposici√≥n</h1>
<div class="sub">Clasifica y vincula los elementos de la nave.</div>

<!-- Biobot al inicio -->
<div id="biobot" class="biobot">
  <h2>ü§ñ Biobot</h2>
  <p>Bienvenido al <b>Pilar 1: Descomposici√≥n</b>.  
  "Soy Biobot y en esta pilar realizaras la <b>Descomposici√≥n</b>, que significa dividir un problema complejo en partes m√°s peque√±as y manejables.  <br>
  <b>Tu Misi√≥n:</b> Clasificar los m√≥dulos de la nave y vincular cada subtarea en el lugar correcto.</p>
</div>

<div id="toolbox" class="tray">
  <!-- M√≥dulos -->
  <div class="chip" draggable="true" data-type="mod" data-key="energia">‚ö° Energ√≠a</div>
  <div class="chip" draggable="true" data-type="mod" data-key="motor">üîß Motor</div>
  <div class="chip" draggable="true" data-type="mod" data-key="comunicaciones">üì° Comunicaciones</div>
  <div class="chip" draggable="true" data-type="mod" data-key="navegacion">üß≠ Navegaci√≥n</div>
  <!-- Subtareas -->
  <div class="chip" draggable="true" data-type="sub" data-key="bateria">Verificar bater√≠as</div>
  <div class="chip" draggable="true" data-type="sub" data-key="paneles">Revisar paneles</div>
  <div class="chip" draggable="true" data-type="sub" data-key="propulsores">Calibrar propulsores</div>
  <div class="chip" draggable="true" data-type="sub" data-key="aceite">Chequear aceite</div>
  <div class="chip" draggable="true" data-type="sub" data-key="antenas">Alinear antenas</div>
  <div class="chip" draggable="true" data-type="sub" data-key="frecuencias">Configurar frecuencias</div>
  <div class="chip" draggable="true" data-type="sub" data-key="sensores">Sincronizar sensores</div>
  <div class="chip" draggable="true" data-type="sub" data-key="ruta">Cargar ruta</div>
  <!-- Distractores -->
  <div class="chip" draggable="true" data-type="ruido" data-key="pintar">Pintar casco</div>
  <div class="chip" draggable="true" data-type="ruido" data-key="neon">Luces de ne√≥n</div>
  <div class="chip" draggable="true" data-type="ruido" data-key="selfies">Tomar selfies</div>
  <div class="chip" draggable="true" data-type="ruido" data-key="karaoke">Organizar karaoke</div>
</div>

<div class="zones">
  <div class="zone" data-accept="mod"><h3>M√≥dulos</h3><div class="bucket" id="bucket-mods"></div></div>
  <div class="zone" data-accept="sub"><h3>Subtareas</h3><div class="bucket" id="bucket-subs"></div></div>
  <div class="zone" data-accept="ruido"><h3>No pertenece</h3><div class="bucket" id="bucket-ruido"></div></div>
</div>

<button onclick="goPhase2()">Ir a vincular subtareas</button>

<div id="phase2" style="display:none;padding:12px">
  <h2>Fase 2 ¬∑ Vinculaci√≥n</h2>
  <div id="modulesArea"></div>
  <button onclick="evaluar()">Evaluar misi√≥n</button>
</div>

<div id="resultado"></div>

<script>
/* Fondo estelar */
(function(){
  const c=document.getElementById('starfield'),ctx=c.getContext('2d');
  function resize(){c.width=innerWidth;c.height=innerHeight}resize();
  addEventListener('resize',resize);
  const stars=[...Array(120)].map(()=>({x:Math.random()*c.width,y:Math.random()*c.height,z:Math.random()*1.2+.2,r:Math.random()*1.4+.2}));
  function step(){
    ctx.clearRect(0,0,c.width,c.height);
    for(const s of stars){
      s.x+=s.z*0.25;s.y+=s.z*0.12;
      if(s.x>c.width) s.x=0;if(s.y>c.height) s.y=0;
      ctx.globalAlpha=.35+s.z*.45;ctx.fillStyle='#bcd7ff';
      ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill();
    }requestAnimationFrame(step);
  }step();
})();

/* Datos correctos */
const CORRECT={
  energia:new Set(['bateria','paneles']),
  motor:new Set(['propulsores','aceite']),
  comunicaciones:new Set(['antenas','frecuencias']),
  navegacion:new Set(['sensores','ruta'])
};
let dragItem=null;

/* Drag b√°sico */
function bindDrag(){
  document.querySelectorAll('.chip').forEach(c=>{
    c.addEventListener('dragstart',()=>dragItem=c);
    c.addEventListener('dragend',()=>dragItem=null);
  });
  document.querySelectorAll('.zone').forEach(z=>{
    z.addEventListener('dragover',e=>e.preventDefault());
    z.addEventListener('drop',e=>{
      e.preventDefault();
      if(dragItem && z.dataset.accept===dragItem.dataset.type){
        z.querySelector('.bucket').appendChild(dragItem);
      }
    });
  });
}

/* Barajar tarjetas */
function shuffleChildren(container){
  const nodes = Array.from(container.children);
  for(let i=nodes.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    container.appendChild(nodes[j]);
  }
}

document.addEventListener("DOMContentLoaded",()=>{
  const toolbox=document.getElementById("toolbox");
  shuffleChildren(toolbox); // barajar al cargar
  bindDrag();
});

/* Ir a fase 2 */
function goPhase2(){
  const mods=[...document.getElementById('bucket-mods').querySelectorAll('.chip[data-type="mod"]')];
  if(mods.length<4){alert("Clasifica los 4 m√≥dulos primero.");return;}
  const area=document.getElementById('modulesArea');area.innerHTML="";
  mods.forEach(m=>{
    const div=document.createElement('div');
    div.className="console";div.dataset.mod=m.dataset.key;
    div.innerHTML=`<h3>${m.textContent}</h3><div class="bucket"></div><div class="state warn" id="st-${m.dataset.key}">‚è≥ Incompleto</div>`;
    area.appendChild(div);
    div.addEventListener('dragover',e=>e.preventDefault());
    div.addEventListener('drop',e=>{
      e.preventDefault();
      if(dragItem && dragItem.dataset.type==="sub"){
        div.querySelector('.bucket').appendChild(dragItem);
        checkModule(div.dataset.mod);
      }
    });
  });
  document.getElementById('phase2').style.display="block";
  biobotSpeak("Ahora vincula cada subtarea al m√≥dulo correcto.");
}

function checkModule(modKey){
  const expected=CORRECT[modKey];
  const placed=[...document.querySelectorAll(`.console[data-mod="${modKey}"] .bucket .chip`)].map(c=>c.dataset.key);
  const st=document.getElementById(`st-${modKey}`);
  const extras=placed.filter(p=>!expected.has(p));
  if(extras.length){
    st.textContent="‚ö†Ô∏è Error en m√≥dulo";st.className="state err";
    biobotSpeak(`Error en ${modKey}. Esa subtarea no corresponde.`);
    return;
  }
  let ok=placed.filter(p=>expected.has(p)).length;
  if(ok<expected.size){
    st.textContent="‚è≥ Incompleto";st.className="state warn";
    biobotSpeak(`El m√≥dulo ${modKey} a√∫n est√° incompleto.`);
  }
  if(ok===expected.size){
    st.textContent="‚úÖ Completado";st.className="state ok";
    biobotSpeak(`¬°Bien hecho! El m√≥dulo ${modKey} est√° completo.`);
  }
}

function evaluar(){
  let completos=0,err=0,incom=0;
  for(const [mod] of Object.entries(CORRECT)){
    const st=document.getElementById(`st-${mod}`);
    if(!st) continue;
    if(st.classList.contains("ok")) completos++;
    else if(st.classList.contains("err")) err++;
    else incom++;
  }
  document.getElementById("resultado").innerHTML=
    `<p>Completados: ${completos} ‚úÖ ¬∑ Incompletos: ${incom} ‚è≥ ¬∑ Errores: ${err} ‚ö†Ô∏è</p>`;
  biobotSpeak("Misi√≥n completada. Has aplicado la descomposici√≥n para organizar un sistema complejo en partes simples. En la vida real, este pilar se usa cuando divides un proyecto en tareas, cuando organizas un entrenamiento por fases o cuando estructuras una investigaci√≥n en secciones. As√≠ los problemas grandes se vuelven manejables.");
}

/* Biobot con voz */
function biobotSpeak(msg){
  const bio=document.getElementById("biobot");
  bio.innerHTML=`<h2>ü§ñ Biobot</h2><p>${msg}</p>`;
  if('speechSynthesis' in window){
    const utter=new SpeechSynthesisUtterance(msg);
    utter.lang="es-ES";
    utter.rate=1;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(utter);
  }
}
</script>
</body>
</html>
