<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pilar 1 ¬∑ Descomposici√≥n</title>
<style>
  :root{
    --ink:#eaf2ff; --muted:#a9b9e6; --bg:#070b16;
    --glass:rgba(15,27,60,.45); --line:#2a3c74;
    --ok:#22c55e; --warn:#facc15; --err:#ef4444;
  }
  body{margin:0;font-family:Poppins,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  #starfield{position:fixed;inset:0;z-index:-1}

  header{padding:16px;text-align:center;border-bottom:1px solid var(--line);background:rgba(10,18,38,.55)}
  header h1{margin:0;color:#4ade80;font-size:22px}
  header .sub{margin-top:6px;color:var(--muted)}

  .panel{background:var(--glass);border:1px solid var(--line);border-radius:12px;padding:12px;margin:12px}

  .tray{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;padding:12px}
  .chip{user-select:none;cursor:grab;border-radius:12px;padding:10px 12px;
        font-size:.95rem;background:rgba(20,32,70,.6);border:1px solid #2c3f79;
        box-shadow:0 4px 12px rgba(0,0,0,.4)}
  .chip:hover{transform:scale(1.05)}
  .chip:active{cursor:grabbing;transform:scale(.97)}

  .zones{display:grid;gap:14px;padding:12px}
  @media(min-width:860px){.zones{grid-template-columns:1fr 1fr 1fr}}
  .zone{min-height:140px;border:1.5px dashed #2e3f76;border-radius:14px;padding:10px;
        background:rgba(15,27,60,.4)}
  .zone h3{text-align:center;margin:0 0 6px;color:var(--muted)}
  .bucket{min-height:80px;display:flex;flex-wrap:wrap;gap:8px;justify-content:center}

  .console{border:1px solid var(--line);border-radius:12px;padding:12px;margin-top:10px;
           background:var(--glass)}
  .state{margin-top:6px;font-weight:bold;text-align:center}
  .ok{color:var(--ok)}.warn{color:var(--warn)}.err{color:var(--err)}

  button{margin:12px;padding:10px 14px;background:#238636;color:#fff;border:none;border-radius:10px;cursor:pointer}
  button:hover{background:#2ea043}

  .biobot{display:flex;gap:10px;align-items:center;padding:12px;border-radius:12px;
          background:rgba(14,26,62,.7);border:1px solid var(--line);margin:12px}
  .face{width:40px;height:40px;border-radius:50%;display:grid;place-items:center;
        background:radial-gradient(circle,#4ade80,#166534);color:#062315;font-weight:bold}
  #resultado{margin:16px;padding:14px;border-radius:12px;background:var(--glass);text-align:center;font-size:1.1rem}

  #navePanel{text-align:center;margin:16px;padding:14px;border-radius:12px;background:var(--glass);font-size:1.2rem}
  #nave{font-size:2rem;margin-top:8px}
</style>
</head>
<body>
<canvas id="starfield"></canvas>

<header>
  <h1>Pilar 1: Descomposici√≥n</h1>
  <div class="sub">Divide un problema complejo en partes manejables</div>
</header>

<!-- Biobot -->
<section class="panel">
  <div class="biobot">
    <div class="face">‚óé</div>
    <div id="biobotMsg">Cargando‚Ä¶</div>
  </div>
</section>

<!-- Tarjetas -->
<div id="toolbox" class="tray">
  <!-- M√≥dulos -->
  <div class="chip" draggable="true" data-type="mod" data-key="energia">‚ö° Energ√≠a</div>
  <div class="chip" draggable="true" data-type="mod" data-key="motor">üîß Motor</div>
  <div class="chip" draggable="true" data-type="mod" data-key="comunicaciones">üì° Comunicaciones</div>
  <div class="chip" draggable="true" data-type="mod" data-key="navegacion">üß≠ Navegaci√≥n</div>
  <!-- Subtareas -->
  <div class="chip" draggable="true" data-type="sub" data-key="bateria">Verificar bater√≠as</div>
  <div class="chip" draggable="true" data-type="sub" data-key="paneles">Revisar paneles</div>
  <div class="chip" draggable="true" data-type="sub" data-key="propulsores">Calibrar propulsores</div>
  <div class="chip" draggable="true" data-type="sub" data-key="aceite">Chequear aceite</div>
  <div class="chip" draggable="true" data-type="sub" data-key="antenas">Alinear antenas</div>
  <div class="chip" draggable="true" data-type="sub" data-key="frecuencias">Configurar frecuencias</div>
  <div class="chip" draggable="true" data-type="sub" data-key="sensores">Sincronizar sensores</div>
  <div class="chip" draggable="true" data-type="sub" data-key="ruta">Cargar ruta</div>
  <!-- Distractores -->
  <div class="chip" draggable="true" data-type="ruido" data-key="pintar">Pintar casco</div>
  <div class="chip" draggable="true" data-type="ruido" data-key="neon">Luces de ne√≥n</div>
  <div class="chip" draggable="true" data-type="ruido" data-key="selfies">Tomar selfies</div>
  <div class="chip" draggable="true" data-type="ruido" data-key="karaoke">Organizar karaoke</div>
</div>

<!-- Zonas -->
<div class="zones">
  <div class="zone" data-accept="mod"><h3>M√≥dulos</h3><div class="bucket" id="bucket-mods"></div></div>
  <div class="zone" data-accept="sub"><h3>Subtareas</h3><div class="bucket" id="bucket-subs"></div></div>
  <div class="zone" data-accept="ruido"><h3>No pertenece</h3><div class="bucket" id="bucket-ruido"></div></div>
</div>

<div class="actions">
  <button onclick="goPhase2()">Ir a revisar m√≥dulos</button>
</div>

<!-- Fase 2 -->
<div id="phase2" style="display:none;padding:12px">
  <h2>Fase 2 ¬∑ Revisi√≥n de sistemas</h2>
  <div id="modulesArea"></div>
  <button onclick="evaluar()">Finalizar misi√≥n</button>
</div>

<div id="resultado"></div>

<!-- Estado de la nave (abajo) -->
<div id="navePanel">
  <h2>Estado de la nave</h2>
  <div id="nave">üöÄ‚ùå Averiada</div>
</div>

<script>
/* Fondo estelar */
(function(){
  const c=document.getElementById('starfield'),ctx=c.getContext('2d');
  function resize(){c.width=innerWidth;c.height=innerHeight}resize();
  addEventListener('resize',resize);
  const stars=[...Array(120)].map(()=>({x:Math.random()*c.width,y:Math.random()*c.height,z:Math.random()*1.2+.2,r:Math.random()*1.4+.2}));
  function step(){
    ctx.clearRect(0,0,c.width,c.height);
    for(const s of stars){
      s.x+=s.z*0.25;s.y+=s.z*0.12;
      if(s.x>c.width) s.x=0;if(s.y>c.height) s.y=0;
      ctx.globalAlpha=.35+s.z*.45;ctx.fillStyle='#bcd7ff';
      ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill();
    }requestAnimationFrame(step);
  }step();
})();

/* Datos correctos */
const CORRECT={
  energia:new Set(['bateria','paneles']),
  motor:new Set(['propulsores','aceite']),
  comunicaciones:new Set(['antenas','frecuencias']),
  navegacion:new Set(['sensores','ruta'])
};
let dragItem=null;

/* Drag b√°sico */
function bindDrag(){
  document.querySelectorAll('.chip').forEach(c=>{
    c.addEventListener('dragstart',()=>dragItem=c);
    c.addEventListener('dragend',()=>dragItem=null);
  });
  document.querySelectorAll('.zone').forEach(z=>{
    z.addEventListener('dragover',e=>e.preventDefault());
    z.addEventListener('drop',e=>{
      e.preventDefault();
      if(dragItem && z.dataset.accept===dragItem.dataset.type){
        z.querySelector('.bucket').appendChild(dragItem);
      }
    });
  });
}

/* Barajar tarjetas */
function shuffleChildren(container){
  const nodes = Array.from(container.children);
  for(let i=nodes.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    container.appendChild(nodes[j]);
  }
}

/* Ir a fase 2 */
function goPhase2(){
  const mods=[...document.getElementById('bucket-mods').querySelectorAll('.chip[data-type="mod"]')];
  if(mods.length<4){alert("Clasifica los 4 m√≥dulos primero.");return;}
  const area=document.getElementById('modulesArea');area.innerHTML="";
  mods.forEach(m=>{
    const div=document.createElement('div');
    div.className="console";div.dataset.mod=m.dataset.key;
    div.innerHTML=`<h3>${m.textContent}</h3>
      <div class="bucket"></div>
      <div class="state warn" id="st-${m.dataset.key}">üî¥ Averiado</div>`;
    area.appendChild(div);
    div.addEventListener('dragover',e=>e.preventDefault());
    div.addEventListener('drop',e=>{
      e.preventDefault();
      if(dragItem && dragItem.dataset.type==="sub"){
        div.querySelector('.bucket').appendChild(dragItem);
        checkModule(div.dataset.mod);
      }
    });
  });
  document.getElementById('phase2').style.display="block";
  biobotSpeak("Ahora revisa cada m√≥dulo: arrastra sus subtareas correctas para repararlo.");
}

function checkModule(modKey){
  const expected=CORRECT[modKey];
  const placed=[...document.querySelectorAll(`.console[data-mod="${modKey}"] .bucket .chip`)].map(c=>c.dataset.key);
  const st=document.getElementById(`st-${modKey}`);
  const extras=placed.filter(p=>!expected.has(p));
  if(extras.length){
    st.textContent="‚ö†Ô∏è Error detectado";st.className="state err";
    biobotSpeak(`El m√≥dulo ${modKey} a√∫n tiene fallos.`);
    return;
  }
  let ok=placed.filter(p=>expected.has(p)).length;
  if(ok<expected.size){
    st.textContent="‚è≥ Incompleto";st.className="state warn";
  }
  if(ok===expected.size){
    st.textContent="üü¢ Reparado";st.className="state ok";
    biobotSpeak(`El m√≥dulo ${modKey} qued√≥ reparado.`);
  }
}

function evaluar(){
  let completos=0,err=0;
  for(const [mod] of Object.entries(CORRECT)){
    const st=document.getElementById(`st-${mod}`);
    if(!st) continue;
    if(st.classList.contains("ok")) completos++;
    else if(st.classList.contains("err")) err++;
  }

  if(completos===4 && err===0){
    document.getElementById("nave").innerHTML="üöÄ‚ú® Lista para despegar";
    document.getElementById("resultado").innerHTML=
      "¬°Misi√≥n cumplida! Reparaste la nave revisando cada m√≥dulo por separado.";
    biobotSpeak("Excelente trabajo. La nave est√° lista gracias a que Has aplicado la descomposici√≥n al revisar cada sistema de manera independiente.
                En la vida real, este pilar se usa cuando divides un proyecto en tareas, cuando organizas un entrenamiento por fases o cuando estructuras una investigaci√≥n en secciones");
  }else{
    document.getElementById("nave").innerHTML="üöÄ‚ùå Averiada";
    document.getElementById("resultado").innerHTML="A√∫n hay m√≥dulos con fallos o incompletos.";
    biobotSpeak("Todav√≠a quedan sistemas averiados. Revisa de nuevo las subtareas.");
  }
}

/* --- Biobot con voz --- */
let selectedVoice = null;
function pickSpanishVoice() {
  const voices = window.speechSynthesis.getVoices();
  selectedVoice = voices.find(v => /^es(-|_|$)/i.test(v.lang)) || voices[0] || null;
}
if ('speechSynthesis' in window) {
  window.speechSynthesis.onvoiceschanged = pickSpanishVoice;
  pickSpanishVoice();
}

const biobot = document.getElementById("biobotMsg");
function biobotSpeak(msg) {
  biobot.innerHTML = msg;
  if ('speechSynthesis' in window) {
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(msg.replace(/<[^>]+>/g,""));
    if (selectedVoice) u.voice = selectedVoice;
    u.lang = selectedVoice?.lang || "es-ES";
    u.rate = 1;
    setTimeout(()=>window.speechSynthesis.speak(u),200);
  }
}

/* Inicio */
document.addEventListener("DOMContentLoaded",()=>{
  const toolbox=document.getElementById("toolbox");
  shuffleChildren(toolbox); // barajar tarjetas al inicio
  bindDrag();
  biobotSpeak("Soy Biobot. En el Pilar 1 trabajaremos la Descomposici√≥n, que significa dividir un problema complejo en partes m√°s peque√±as y manejables.
              Tu misi√≥n es reparar la nave que est√° averiada, revisando cada m√≥dulo y asignando sus subtareas correctas.");
});
</script>
  <div id="resultado"></div>

<!-- Bot√≥n de volver -->
<div class="actions" style="text-align:center;margin:20px 0;">
  <a href="https://cgviviana.github.io/Asignaturas-FUAA/PtoComp/AppPC/0/" 
     class="btn-home">‚èÆ Volver al inicio</a>
</div>
</body>
</html>
