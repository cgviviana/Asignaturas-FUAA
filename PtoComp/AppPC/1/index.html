<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bitnarys ¬∑ Pilar 1: Descomposici√≥n</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --ink:#eaf2ff; --muted:#a9b9e6; --bg:#050913;
    --glass:rgba(15,27,60,.55); --line:#2a3c74;
    --ok:#22c55e; --warn:#facc15; --err:#ef4444;
    --neon:#4ade80;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Poppins,Arial,sans-serif;background:var(--bg);color:var(--ink)}

  /* Fondo gal√°ctico asegurado */
  #starfield{
    position:fixed; top:0; left:0; width:100%; height:100%;
    z-index:-2; background:#000;
  }
  .halo{
    position:fixed; inset:0; z-index:-1; pointer-events:none;
    background:
      radial-gradient(800px 500px at 80% 8%, rgba(96,165,250,.25), transparent 45%),
      radial-gradient(700px 460px at 10% 90%, rgba(167,139,250,.22), transparent 50%);
    mix-blend-mode:screen;
  }

  header{padding:12px 16px;background:rgba(10,18,38,.75);backdrop-filter:blur(6px);border-bottom:1px solid var(--line)}
  h1{margin:0;font-size:20px;color:var(--neon);font-family:"Orbitron",sans-serif;letter-spacing:1px}
  .sub{font-size:13px;color:var(--muted)}

  main{padding:12px;display:grid;gap:12px}

  /* Panel gal√°ctico */
  .panel{
    background:var(--glass); border:1px solid var(--line); border-radius:12px; padding:12px;
    box-shadow:0 0 12px rgba(74,222,128,.35), inset 0 0 8px rgba(96,165,250,.15)
  }

  /* Bandeja tarjetas (Fase 1 fluida) */
  .tray{display:flex;flex-wrap:wrap;gap:10px;padding:8px}
  .chip{
    user-select:none; cursor:grab; border-radius:10px; padding:10px; text-align:center;
    background:#12204b; border:1px solid #2c3f79;
    box-shadow:0 0 6px rgba(96,165,250,.45), 0 0 12px rgba(74,222,128,.25)
  }

  /* Zonas */
  .zones{display:grid;gap:10px}
  .zone{border:1.2px dashed #2e3f76; border-radius:10px; padding:8px; box-shadow:inset 0 0 8px rgba(96,165,250,.2)}
  .bucket{min-height:50px; display:flex; flex-wrap:wrap; gap:6px}

  /* Consolas Fase 2 en tablero 2√ó2 (responsive a 1 col. en pantallas muy peque√±as) */
  #linking{display:grid; grid-template-columns:repeat(2,1fr); gap:12px}
  @media(max-width:420px){#linking{grid-template-columns:1fr}}
  .console{
    background:rgba(16,28,62,.7); border:1px solid var(--line); border-radius:10px; padding:10px;
    box-shadow:0 0 8px rgba(74,222,128,.25), inset 0 0 8px rgba(167,139,250,.15)
  }
  .state{margin-top:6px; font-weight:bold; font-family:"Orbitron",sans-serif}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}

  /* Progreso */
  .meter{height:10px; background:#0b1535; border:1px solid #203064; border-radius:999px; overflow:hidden}
  .bar{height:100%; width:0%; background:linear-gradient(90deg,#22c55e,#4ade80)}
  .stars{display:flex; gap:4px; font-size:18px; margin-top:6px}
  .stars .off{opacity:.35}

  /* Biobot */
  .biobot{
    display:flex; gap:10px; align-items:center; padding:10px; border-radius:10px;
    background:rgba(14,26,62,.8); border:1px solid var(--line);
    box-shadow:0 0 14px rgba(74,222,128,.35), inset 0 0 8px rgba(96,165,250,.25)
  }
  .face{
    width:40px; height:40px; border-radius:50%; display:grid; place-items:center;
    background:radial-gradient(circle,#4ade80,#166534); color:#062315; font-weight:bold; font-family:"Orbitron",sans-serif
  }
</style>
</head>
<body>
<canvas id="starfield"></canvas>
<div class="halo"></div>

<header>
  <h1>Bitnarys ¬∑ Pilar 1: Descomposici√≥n</h1>
  <div class="sub">Fase 1 cl√°sica ¬∑ Fase 2 en tablero 2√ó2</div>
</header>

<main>
  <section class="panel">
    <h3>Fase 1 ¬∑ Clasificaci√≥n</h3>
    <p class="sub">Arrastra tarjetas a <b>M√≥dulos</b>, <b>Subtareas</b> o <b>No pertenece</b>.</p>
    <div id="toolbox" class="tray"></div>

    <div class="zones">
      <div class="zone" data-accept="mod"><h4>M√≥dulos</h4><div class="bucket" id="bucket-mods"></div></div>
      <div class="zone" data-accept="sub"><h4>Subtareas</h4><div class="bucket" id="bucket-subs"></div></div>
      <div class="zone" data-accept="ruido"><h4>No pertenece</h4><div class="bucket" id="bucket-ruido"></div></div>
    </div>
    <button id="toPhase2">Ir a Fase 2</button>
  </section>

  <section class="panel" id="phase2" style="display:none">
    <h3>Fase 2 ¬∑ Vinculaci√≥n</h3>
    <p class="sub">Arrastra cada subtarea a su m√≥dulo correspondiente.</p>
    <div id="linking"></div>
    <button id="evaluate">Evaluar misi√≥n</button>
  </section>

  <section class="panel">
    <h3>Progreso</h3>
    <div class="meter"><div id="bar" class="bar"></div></div>
    <div class="stars" id="stars"><span class="off">‚òÖ</span><span class="off">‚òÖ</span><span class="off">‚òÖ</span><span class="off">‚òÖ</span></div>
  </section>

  <section class="panel">
    <h3>Biobot</h3>
    <div class="biobot"><div class="face">‚óé</div><div id="biobotMsg">Cargando‚Ä¶</div></div>
  </section>

  <section class="panel" id="summary" style="display:none">
    <h3>Informe de misi√≥n</h3>
    <div id="resume" class="sub">A√∫n sin evaluar‚Ä¶</div>
  </section>
</main>

<script>
/* Fondo estelar animado (robusto) */
(function(){
  const c=document.getElementById('starfield'), ctx=c.getContext('2d');
  function resize(){ c.width=innerWidth; c.height=innerHeight; }
  resize(); addEventListener('resize',resize);
  const stars=[...Array(140)].map(()=>({x:Math.random()*c.width,y:Math.random()*c.height,z:Math.random()*1+0.25}));
  function step(){
    ctx.clearRect(0,0,c.width,c.height);
    for(const s of stars){
      s.x+=s.z*0.3; s.y+=s.z*0.15;
      if(s.x>c.width) s.x=0;
      if(s.y>c.height) s.y=0;
      ctx.fillStyle="#cfe0ff"; ctx.globalAlpha=0.55; ctx.fillRect(s.x,s.y,1.4,1.4);
    }
    requestAnimationFrame(step);
  }
  step();
})();

/* Datos de tarjetas */
const CARDS=[
  {t:"‚ö° Energ√≠a",type:"mod",key:"energia"},
  {t:"üîß Motor",type:"mod",key:"motor"},
  {t:"üì° Comunicaciones",type:"mod",key:"comunicaciones"},
  {t:"üß≠ Navegaci√≥n",type:"mod",key:"navegacion"},
  {t:"Verificar bater√≠as",type:"sub",key:"bateria"},
  {t:"Revisar paneles",type:"sub",key:"paneles"},
  {t:"Calibrar propulsores",type:"sub",key:"propulsores"},
  {t:"Chequear aceite",type:"sub",key:"aceite"},
  {t:"Alinear antenas",type:"sub",key:"antenas"},
  {t:"Configurar frecuencias",type:"sub",key:"frecuencias"},
  {t:"Sincronizar sensores",type:"sub",key:"sensores"},
  {t:"Cargar ruta",type:"sub",key:"ruta"},
  {t:"Pintar casco",type:"ruido",key:"pintar"},
  {t:"Luces de ne√≥n",type:"ruido",key:"neon"},
  {t:"Tomar selfies",type:"ruido",key:"selfies"},
  {t:"Organizar karaoke",type:"ruido",key:"karaoke"}
];
const CORRECT={
  energia:new Set(['bateria','paneles']),
  motor:new Set(['propulsores','aceite']),
  comunicaciones:new Set(['antenas','frecuencias']),
  navegacion:new Set(['sensores','ruta'])
};
const MODULE_ORDER=['energia','motor','comunicaciones','navegacion'];

/* Utilidades */
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a;}
const toolbox=document.getElementById('toolbox');
shuffle(CARDS).forEach(c=>{
  const el=document.createElement('div');
  el.className='chip'; el.draggable=true; el.textContent=c.t;
  el.dataset.type=c.type; el.dataset.key=c.key;
  toolbox.appendChild(el);
});

/* Drag & Drop */
let dragItem=null;
function initDrag(root){
  root.querySelectorAll('.chip').forEach(ch=>{
    ch.addEventListener('dragstart',()=>{dragItem=ch});
    ch.addEventListener('dragend',()=>{dragItem=null});
  });
}
initDrag(toolbox);

document.querySelectorAll('.zone').forEach(z=>{
  z.addEventListener('dragover',e=>e.preventDefault());
  z.addEventListener('drop',e=>{
    e.preventDefault();
    if(dragItem && dragItem.dataset.type===z.dataset.accept){
      z.querySelector('.bucket').appendChild(dragItem);
    }
  });
});

/* Biobot */
const biobot=document.getElementById('biobotMsg');
function say(html){ biobot.innerHTML = html; } // <= Muestra SIEMPRE el mensaje

/* Mensaje pedag√≥gico inicial (visible al cargar) */
say(
  "ü§ñ <b>Hola explorador</b>. Hoy trabajaremos el pilar de la <b>Descomposici√≥n</b> en el pensamiento computacional. " +
  "Significa <b>dividir un problema grande</b> en partes m√°s peque√±as para resolverlo paso a paso.<br><br>" +
  "üöÄ <b>Misi√≥n:</b> 1) Clasifica los <b>M√≥dulos</b> principales de la nave. 2) Coloca las <b>Subtareas</b> correctas en cada m√≥dulo. " +
  "3) Env√≠a a <b>No pertenece</b> lo que sea ruido."
);

/* Fase 2: tablero 2√ó2 */
const linking=document.getElementById('linking');
document.getElementById('toPhase2').onclick=()=>{
  const mods=[...document.getElementById('bucket-mods').querySelectorAll('.chip[data-type="mod"]')].map(m=>m.dataset.key);
  if(mods.length<4){ say("‚ö†Ô∏è A√∫n faltan <b>m√≥dulos</b> en la zona de M√≥dulos para avanzar."); return; }
  linking.innerHTML="";
  MODULE_ORDER.forEach(k=>{
    if(!mods.includes(k)) return;
    const div=document.createElement('div');
    div.className="console"; div.dataset.mod=k;
    div.innerHTML=`<h4 style="font-family:Orbitron;margin:0 0 6px">${k.toUpperCase()}</h4>
      <div class="zone" data-accept="sub" data-link="${k}"><div class="bucket"></div></div>
      <div class="state warn" id="st-${k}">‚è≥ Incompleto</div>`;
    linking.appendChild(div);
  });
  document.getElementById('phase2').style.display="block";
  initDrag(linking);
  linking.querySelectorAll('.zone').forEach(z=>{
    z.addEventListener('dragover',e=>e.preventDefault());
    z.addEventListener('drop',e=>{
      e.preventDefault();
      if(dragItem && dragItem.dataset.type==="sub"){
        z.querySelector('.bucket').appendChild(dragItem);
        checkModule(z.dataset.link);
      }
    });
  });
  say("üîß Vincula cada <b>subtarea</b> con su <b>m√≥dulo</b> correspondiente.");
};

/* Estados por m√≥dulo */
function checkModule(k){
  const expected=CORRECT[k];
  const placed=[...document.querySelectorAll(`.zone[data-link="${k}"] .bucket .chip`)].map(c=>c.dataset.key);
  const st=document.getElementById("st-"+k);
  if(placed.some(p=>!expected.has(p))){
    st.textContent="‚ö†Ô∏è Error"; st.className="state err";
    say("‚ùå Hay elementos que <b>no corresponden</b> en <b>"+k+"</b>. Ret√≠ralos.");
    return;
  }
  if(placed.length<expected.size){
    st.textContent="‚è≥ Incompleto"; st.className="state warn";
    say("‚è≥ A√∫n faltan subtareas en <b>"+k+"</b>.");
  }else{
    st.textContent="‚úÖ Completado"; st.className="state ok";
    say("‚úîÔ∏è <b>"+k+"</b> qued√≥ correcto.");
  }
  setProgress();
}

/* Evaluaci√≥n general */
document.getElementById('evaluate').onclick=()=>{
  let ok=0,err=0,warn=0;
  MODULE_ORDER.forEach(k=>{
    const st=document.getElementById("st-"+k);
    if(!st) warn++;
    else if(st.classList.contains("ok")) ok++;
    else if(st.classList.contains("err")) err++;
    else warn++;
  });

  document.getElementById("resume").innerHTML=`Completados: ${ok} ‚úÖ ¬∑ Incompletos: ${warn} ‚è≥ ¬∑ Errores: ${err} ‚ö†Ô∏è`;
  document.getElementById("summary").style.display="block";

  const stars=document.getElementById("stars").children;
  let score = (ok===4 && err===0) ? 4 : (ok===3 && err===0) ? 3 : (ok>=2 && err<=1) ? 2 : ok ? 1 : 0;
  for(let i=0;i<4;i++) stars[i].classList.toggle("off", i>=score);

  if(ok===4 && err===0){
    say("üéâ <b>¬°Misi√≥n completada con √©xito!</b><br><br>" +
        "La <b>Descomposici√≥n</b> te permiti√≥ organizar un problema complejo en partes m√°s simples. " +
        "En la vida real se aplica al <b>planear proyectos</b>, <b>estudiar temas dif√≠ciles</b> o <b>resolver retos paso a paso</b>.<br><br>" +
        "üöÄ <b>¬°Felicitaciones, has terminado la misi√≥n en Bitnarys!</b>");
  }else if(err>0){
    say("‚ùå Corrige los m√≥dulos con <b>Error</b> y vuelve a evaluar.");
  }else{
    say("‚è≥ A√∫n quedan m√≥dulos <b>Incompletos</b>. Revisa las subtareas faltantes.");
  }
};

/* Progreso visual */
function setProgress(){
  let pct=0, hasErr=false;
  MODULE_ORDER.forEach(k=>{
    const st=document.getElementById("st-"+k);
    if(st && st.classList.contains("ok")) pct+=25;
    if(st && st.classList.contains("err")) hasErr=true;
  });
  if(hasErr) pct=Math.max(0,pct-10);
  document.getElementById("bar").style.width=pct+"%";
}
</script>
</body>
</html>
