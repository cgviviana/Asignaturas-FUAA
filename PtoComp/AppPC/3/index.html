<!DOCTYPE html> 
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pilar 3 ¬∑ Reconocimiento de Patrones</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    /* Mismos tokens que Pilar 1/2 */
    --ink:#eaf2ff; --muted:#a9b9e6; --bg:#070b16;
    --glass:rgba(15,27,60,.45); --line:#2a3c74;
    --ok:#22c55e; --warn:#facc15; --err:#ef4444;
  }
  body{margin:0;font-family:Poppins,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  #starfield{position:fixed;inset:0;z-index:-1}

  /* Encabezado uniforme (como P1/P2) */
  header{padding:16px 12px;text-align:center;border-bottom:1px solid var(--line);background:rgba(10,18,38,.55)}
  header h1{margin:0;color:#4ade80;font-size:22px;letter-spacing:.3px}
  header .sub{margin-top:6px;color:var(--muted);font-size:14px}

  /* Paneles simples como P1/P2 */
  .panel{background:var(--glass);border:1px solid var(--line);border-radius:12px;padding:12px;margin:12px}

  /* Bandeja (grid 4xN como P1/P2) */
  .tray{
    display:grid;grid-template-columns:repeat(4,1fr);
    gap:12px;padding:8px
  }
  @media (max-width:1000px){.tray{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:600px){.tray{grid-template-columns:1fr}}

  .chip{
    user-select:none;cursor:grab;border-radius:12px;padding:10px 12px;text-align:center;
    background:rgba(20,32,70,.60);border:1px solid #2c3f79;box-shadow:0 4px 12px rgba(0,0,0,.4);
    transition:transform .15s ease;font-size:.95rem
  }
  .chip:hover{transform:scale(1.05)}
  .chip:active{cursor:grabbing;transform:scale(.97)}

  /* Zonas (igual estilo P1/P2) */
  .zone{
    border:1.5px dashed #2e3f76;border-radius:12px;padding:10px;min-height:70px;
    background:rgba(15,27,60,.4);display:flex;flex-wrap:wrap;gap:8px;align-items:flex-start
  }
  .zone h4{margin:0 0 6px 0;width:100%;text-align:center;color:var(--muted);font-weight:600}
  .zones{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  #phase1 .zones{grid-template-columns:repeat(4,1fr)}

  /* Estados de sistemas (respetando tu estructura) */
  .system{padding:10px;border-radius:10px;margin:8px 0;font-weight:600;text-align:center}
  .offSys{background:#311b1b;color:#f87171}
  .onSys{background:#052e16;color:#4ade80}

  /* Biobot como en P1/P2 (arriba, voz y texto) */
  .biobot{
    margin:12px;padding:14px;border-radius:14px;background:rgba(14,26,62,.7);
    border:1px solid var(--line);box-shadow:0 0 14px rgba(74,222,128,.35);display:flex;gap:10px;align-items:center
  }
  .face{width:40px;height:40px;border-radius:50%;display:grid;place-items:center;
        background:radial-gradient(circle,#4ade80,#166534);color:#062315;font-weight:bold}

  /* Botones (id√©nticos a P1/P2) */
  .actions{display:flex;gap:10px;justify-content:center;padding:8px 12px}
  button{
    padding:10px 14px;background:#238636;color:#fff;border:none;border-radius:10px;cursor:pointer
  }
  button:hover{background:#2ea043}

  /* Resultado simple como P1/P2 */
  #resultado{margin:12px;padding:12px;border-radius:12px;background:var(--glass);border:1px solid var(--line)}
</style>
</head>
<body>
<canvas id="starfield"></canvas>

<header>
  <h1>Pilar 3: Reconocimiento de Patrones</h1>
  <div class="sub">Repara los sistemas de la nave identificando patrones</div>
</header>

<!-- Biobot arriba (mismo comportamiento que P1/P2) -->
<section class="panel" id="bioPanel">
  <div class="biobot">
    <div class="face">‚óé</div>
    <div id="biobotMsg">Cargando‚Ä¶</div>
  </div>
</section>

<main>
  <!-- Fase 1 -->
  <section class="panel" id="phase1">
    <h3 style="text-align:center;margin:6px 0 8px">Fase 1 ¬∑ Identificaci√≥n</h3>
    <p class="sub" style="text-align:center">Clasifica las tarjetas en <b>Energ√≠a</b>, <b>Comunicaci√≥n</b>, <b>Navegaci√≥n</b> o <b>No pertenece</b>.</p>

    <div id="toolbox" class="tray"></div>

    <div class="zones">
      <div class="zone" data-accept="energia" id="bucket-energia"><h4>‚ö° Energ√≠a</h4></div>
      <div class="zone" data-accept="comunicacion" id="bucket-comunicacion"><h4>üì° Comunicaci√≥n</h4></div>
      <div class="zone" data-accept="navegacion" id="bucket-navegacion"><h4>üß≠ Navegaci√≥n</h4></div>
      <div class="zone" data-accept="ruido" id="bucket-ruido"><h4>üóëÔ∏è No pertenece</h4></div>
    </div>

    <div class="actions"><button id="toPhase2">Ir a Fase 2</button></div>
  </section>

  <!-- Fase 2 -->
  <section class="panel" id="phase2" style="display:none">
    <h3 style="text-align:center;margin:6px 0 8px">Fase 2 ¬∑ Reconexi√≥n de Patrones</h3>
    <p class="sub" style="text-align:center">Arrastra los componentes al sistema correcto para repararlo.</p>

    <div id="linkBoard" class="zone"><h4>Componentes disponibles</h4></div>

    <div class="zones">
      <div class="zone" data-accept="energia" id="zone-energia"><h4>‚ö° Energ√≠a</h4></div>
      <div class="zone" data-accept="comunicacion" id="zone-comunicacion"><h4>üì° Comunicaci√≥n</h4></div>
      <div class="zone" data-accept="navegacion" id="zone-navegacion"><h4>üß≠ Navegaci√≥n</h4></div>
    </div>

    <div id="systems">
      <div id="sys-energia" class="system offSys">‚ö° Energ√≠a: Desactivado</div>
      <div id="sys-comunicacion" class="system offSys">üì° Comunicaci√≥n: Desactivado</div>
      <div id="sys-navegacion" class="system offSys">üß≠ Navegaci√≥n: Desactivado</div>
    </div>

    <div class="actions"><button id="evaluate">Evaluar misi√≥n</button></div>
  </section>

  <section class="panel">
    <div id="resultado"></div>
  </section>
</main>

<script>
/* Fondo estelar (igual a P1/P2) */
(function(){
  const c=document.getElementById('starfield'),ctx=c.getContext('2d');
  function resize(){c.width=innerWidth;c.height=innerHeight} resize();
  addEventListener('resize',resize);
  const stars=[...Array(120)].map(()=>({x:Math.random()*c.width,y:Math.random()*c.height,z:Math.random()*1.2+.2,r:Math.random()*1.4+.2}));
  function step(){
    ctx.clearRect(0,0,c.width,c.height);
    for(const s of stars){
      s.x+=s.z*0.25; s.y+=s.z*0.12;
      if(s.x>c.width) s.x=0; if(s.y>c.height) s.y=0;
      ctx.globalAlpha=.35+s.z*.45; ctx.fillStyle='#bcd7ff';
      ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();
    }
    requestAnimationFrame(step);
  } step();
})();

/* Datos (tus mismas tarjetas) + barajado */
const CARDS=[
  {t:"üîã Bater√≠a solar",type:"energia"},
  {t:"‚ö° Panel el√©ctrico",type:"energia"},
  {t:"üì° Antena larga",type:"comunicacion"},
  {t:"üéôÔ∏è Micr√≥fono de cabina",type:"comunicacion"},
  {t:"üß≠ Giroscopio",type:"navegacion"},
  {t:"üõ∞Ô∏è GPS",type:"navegacion"},
  {t:"üé§ Karaoke",type:"ruido"},
  {t:"üì∏ Selfie espacial",type:"ruido"}
];
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a;}
const toolbox=document.getElementById('toolbox');
shuffle(CARDS).forEach(c=>{
  const el=document.createElement('div');
  el.className='chip'; el.draggable=true; el.textContent=c.t;
  el.dataset.type=c.type; toolbox.appendChild(el);
});

/* Drag & Drop (acepta por tipo; linkBoard acepta todos) */
let dragItem=null;
function initDrag(root){
  root.querySelectorAll('.chip').forEach(ch=>{
    ch.addEventListener('dragstart',()=>{dragItem=ch});
    ch.addEventListener('dragend',()=>{dragItem=null});
  });
}
initDrag(toolbox);

document.querySelectorAll('.zone').forEach(z=>{
  z.addEventListener('dragover',e=>e.preventDefault());
  z.addEventListener('drop',e=>{
    e.preventDefault();
    const accept=z.dataset.accept; // undefined en linkBoard
    if(dragItem && (!accept || dragItem.dataset.type===accept)){
      z.appendChild(dragItem);
      initDrag(z); // re-drag en nuevo contenedor
    }
  });
});

/* Biobot con voz (igual a P1/P2) */
let selectedVoice=null;
function pickSpanishVoice(){
  const vs=window.speechSynthesis.getVoices();
  selectedVoice = vs.find(v=>/^es(-|_|$)/i.test(v.lang)) || vs[0] || null;
}
if('speechSynthesis' in window){
  window.speechSynthesis.onvoiceschanged = pickSpanishVoice;
  pickSpanishVoice();
}
function biobotSpeak(msg){
  const box=document.getElementById('biobotMsg');
  box.innerHTML = msg;
  if('speechSynthesis' in window){
    window.speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(msg.replace(/<[^>]+>/g,'')); // sin HTML
    if(selectedVoice) u.voice=selectedVoice;
    u.lang= selectedVoice?.lang || "es-ES"; u.rate=1;
    setTimeout(()=>window.speechSynthesis.speak(u),300);
  }
}
/* Mensaje inicial */
biobotSpeak("Soy Biobot. En el Pilar 3 trabajaremos el Reconocimiento de Patrones: identificar similitudes y repeticiones para aplicar soluciones conocidas. Primero clasifica; luego repara los sistemas con esas agrupaciones.");

/* Paso a Fase 2 (respetando tu l√≥gica y IDs) */
document.getElementById('toPhase2').onclick=()=>{
  const energia=[...document.querySelectorAll('#bucket-energia .chip')].length;
  const comunicacion=[...document.querySelectorAll('#bucket-comunicacion .chip')].length;
  const navegacion=[...document.querySelectorAll('#bucket-navegacion .chip')].length;

  if(energia<2 || comunicacion<2 || navegacion<2){
    biobotSpeak("A√∫n no has identificado todos los patrones. Revisa la clasificaci√≥n antes de avanzar.");
    return;
  }
  const linkBoard=document.getElementById('linkBoard'); linkBoard.innerHTML='<h4>Componentes disponibles</h4>';
  document.querySelectorAll('#bucket-energia .chip, #bucket-comunicacion .chip, #bucket-navegacion .chip')
    .forEach(ch=>{ linkBoard.appendChild(ch); });

  document.getElementById('phase2').style.display="block";
  biobotSpeak("Perfecto. Ahora mueve cada componente a su sistema. Cuando completes un patr√≥n, ese sistema se encender√°.");
};

/* Evaluaci√≥n (misma estructura + resultado simple como P1/P2) */
document.getElementById('evaluate').onclick=()=>{
  const energia=[...document.querySelectorAll('#zone-energia .chip')].length;
  const comunicacion=[...document.querySelectorAll('#zone-comunicacion .chip')].length;
  const navegacion=[...document.querySelectorAll('#zone-navegacion .chip')].length;

  if(energia===2){const el=document.getElementById("sys-energia");el.className="system onSys";el.textContent="‚ö° Energ√≠a: Activado";}
  if(comunicacion===2){const el=document.getElementById("sys-comunicacion");el.className="system onSys";el.textContent="üì° Comunicaci√≥n: Activado";}
  if(navegacion===2){const el=document.getElementById("sys-navegacion");el.className="system onSys";el.textContent="üß≠ Navegaci√≥n: Activado";}

  const completos=(energia===2)+(comunicacion===2)+(navegacion===2);
  const incompletos=3-completos;
  const errores=0; // aqu√≠ no permitimos ubicar mal por tipo (coherente con tus zonas)

  document.getElementById("resultado").innerHTML =
    `<p>Completados: ${completos} ‚úÖ ¬∑ Incompletos: ${incompletos} ‚è≥ ¬∑ Errores: ${errores} ‚ö†Ô∏è</p>`;

  if(completos===3){
    biobotSpeak("¬°Misi√≥n completada! Reconociste patrones y reparaste la nave. En la vida real, este pilar se aplica cuando detectas estructuras repetidas en c√≥digo, identificas tendencias en datos o reconoces formas r√≠tmicas en m√∫sica para reutilizar soluciones con eficiencia.");
  }else{
    biobotSpeak("A√∫n faltan sistemas por encender. Verifica los patrones y mueve los componentes que queden.");
  }
};
</script>
  <div id="resultado"></div>

<!-- Bot√≥n de volver -->
<div class="actions" style="text-align:center;margin:20px 0;">
  <a href="https://cgviviana.github.io/Asignaturas-FUAA/PtoComp/AppPC/0/" 
     class="btn-home">‚èÆ Volver al inicio</a>
</div>
</body>
</html>
